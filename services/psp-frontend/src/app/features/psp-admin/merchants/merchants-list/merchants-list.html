<section class="page">
  <div class="header">
    <div>
      <h1 class="title">Merchants</h1>
      <p class="subtitle">Manage clients and their active payment channels.</p>
    </div>

    <a class="btnPrimary" routerLink="/merchants/new">+ Add merchant</a>
  </div>

  @if (errorMessage()) {
    <div class="alert">
      {{ errorMessage() }}
      <button type="button" class="btnGhost" (click)="load()">Retry</button>
    </div>
  }

  @if (merchants() === null) {
    <div class="state">Loading...</div>
  } @else {
    <div class="card">
      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Merchant key</th>
              <th>Full name</th>
              <th>Service name</th>
              <th>Active methods</th>
              <th class="actionsCol">Actions</th>
            </tr>
          </thead>

          <tbody>
            @if (merchants()!.length === 0) {
              <tr>
                <td colspan="3" class="emptyCell">No merchants yet.</td>
              </tr>
            } @else {
              @for (m of merchants()!; track trackByMerchantKey($index, m)) {
                <tr>
                  <td class="mono">{{ m.merchantKey }}</td>

                  <td class="mono">{{ m.fullName }}</td>

                  <td class="mono">{{ m.serviceName }}</td>

                  <td>
                    <div class="chips">
                      @for (methodName of m.activeMethods; track methodName) {
                        <span class="chip">{{ methodName }}</span>
                      }
                    </div>
                  </td>

                  <td class="actionsCol">
                    <div class="actionGroup">
                      <a class="btnIcon" [routerLink]="['/merchants', m.merchantKey]" title="Edit">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                      </a>
                      <button class="btnIcon delete" (click)="deleteMerchant(m.id)" title="Delete">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2 2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</section>