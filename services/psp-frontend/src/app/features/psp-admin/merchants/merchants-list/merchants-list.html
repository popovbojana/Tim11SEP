<section class="page">
  <div class="header">
    <div>
      <h1 class="title">Merchants</h1>
    </div>

    <a class="btnPrimary" routerLink="/merchants/new">+ Add merchant</a>
  </div>

  @if (errorMessage()) {
    <div class="alert">
      {{ errorMessage() }}
      <button type="button" class="btnGhost" (click)="load()">Retry</button>
    </div>
  }

  @if (merchants() === null) {
    <div class="state">Loading...</div>
  } @else {
    <div class="card">
      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Merchant key</th>
              <th>Active methods</th>
              <th class="actionsCol">Actions</th>
            </tr>
          </thead>

          <tbody>
            @if (merchants()!.length === 0) {
              <tr>
                <td colspan="3" class="emptyCell">No merchants yet.</td>
              </tr>
            } @else {
              @for (m of merchants()!; track trackByMerchantKey($index, m)) {
                <tr>
                  <td class="mono">{{ m.merchantKey }}</td>

                  <td>
                    <div class="chips">
                      @for (methodName of m.activeMethods; track methodName) {
                        <span class="chip">{{ methodName }}</span>
                      }
                    </div>
                  </td>

                  <td class="actionsCol">
                    <a class="btnOutline" [routerLink]="['/merchants', m.merchantKey]">
                      Edit
                    </a>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</section>