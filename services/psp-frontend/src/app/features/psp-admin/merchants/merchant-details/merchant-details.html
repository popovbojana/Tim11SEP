<section class="page">
  <div class="header">
    <div>
      <h1 class="title">Merchant details</h1>
      <p class="subtitle">View merchant info and choose payment methods.</p>
    </div>

    <a class="btnOutline" routerLink="/merchants">Back</a>
  </div>

  @if (errorMessage()) {
    <div class="alert">
      {{ errorMessage() }}
      <button type="button" class="btnGhost" (click)="load()" [disabled]="merchant() === null || saving">
        Retry
      </button>
    </div>
  }

  @if (successMessage()) {
    <div class="success">
      {{ successMessage() }}
    </div>
  }

  @if (merchant() === null) {
    <div class="state">Loading...</div>
  } @else {
    <div class="card">
      <div class="infoGrid">
        <div class="infoBlock">
          <div class="infoLabel">Merchant key</div>
          <div class="infoValue">
            {{ merchant()?.merchantKey ?? '-' }}
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section">
        <h2 class="sectionTitle">Payment methods</h2>
        <p class="sectionHint">Select at least one.</p>

        <div class="methodsGrid">
          @for (m of allMethods; track m) {
            <button
              type="button"
              class="methodCard"
              [class.selected]="isSelected(m)"
              (click)="toggleMethod(m)"
              [attr.aria-pressed]="isSelected(m)"
            >
              <input
                class="checkbox"
                type="checkbox"
                [checked]="isSelected(m)"
                (click)="$event.stopPropagation()"
                (change)="toggleMethod(m)"
              />
              <span class="methodText">{{ m }}</span>
            </button>
          }
        </div>

        @if (form.controls.methods.touched && form.controls.methods.value.length === 0) {
          <p class="errorText">Pick at least one payment method.</p>
        }

        <button
          class="btnPrimary"
          type="button"
          (click)="save()"
          [disabled]="saving || merchant() === null"
        >
          {{ saving ? 'Saving...' : 'Save methods' }}
        </button>
      </div>
    </div>
  }
</section>
