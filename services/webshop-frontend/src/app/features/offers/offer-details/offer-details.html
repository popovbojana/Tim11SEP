<section class="page">
  @if (errorMessage()) {
    <div class="state stateError">
      <p class="stateText">{{ errorMessage() }}</p>

      <div class="actions">
        <button class="btn btnPrimary" type="button" (click)="loadOffer()">Retry</button>
        <a class="btn btnSecondary" routerLink="/offers">Back to offers</a>
      </div>
    </div>
  } @else if (!isLoaded()) {
  } @else if (!offer()) {
    <div class="state">
      <p class="stateText">Offer not found.</p>
      <a class="btn btnSecondary" routerLink="/offers">Back to offers</a>
    </div>
  } @else {
    <div class="header">
      <div>
        <a class="backLink" routerLink="/offers">‚Üê Offers</a>
        <h1 class="title">{{ offer()!.title }}</h1>
        <p class="subtitle">{{ offer()!.description }}</p>
      </div>

      <div class="headerRight">
        <div class="pill">{{ offer()!.vehicle.type }}</div>

        @if (isLoggedIn()) {
          <button
            class="btn btnPrimary"
            type="button"
            [routerLink]="['/offers', offer()!.id, 'reserve']"
          >
            Reserve
          </button>
        } @else {
          <a class="btn btnSecondary" routerLink="/auth/login">
            Login to reserve
          </a>
        }
      </div>
    </div>

    <div class="layout">
      <div class="card">
        <h3 class="sectionTitle">Vehicle</h3>

        <div class="meta">
          <div class="metaRow">
            <span class="metaLabel">Model</span>
            <span class="metaValue">{{ getVehicleLabel() }}</span>
          </div>

          <div class="metaRow">
            <span class="metaLabel">Vehicle / day</span>
            <span class="metaValue">{{ offer()!.vehicle.pricePerDay }} EUR</span>
          </div>
        </div>

        <p class="muted">{{ offer()!.vehicle.description }}</p>
      </div>

      <div class="card">
        <h3 class="sectionTitle">Insurance</h3>

        <div class="meta">
          <div class="metaRow">
            <span class="metaLabel">Package</span>
            <span class="metaValue">{{ offer()!.insurancePackage.name }}</span>
          </div>

          <div class="metaRow">
            <span class="metaLabel">Insurance / day</span>
            <span class="metaValue">{{ offer()!.insurancePackage.pricePerDay }} EUR</span>
          </div>
        </div>

        <p class="muted">{{ offer()!.insurancePackage.description }}</p>
      </div>

      <div class="card cardFull">
        <h3 class="sectionTitle">Additional services</h3>

        @if (offer()!.additionalServices.length === 0) {
          <p class="muted">No additional services.</p>
        } @else {
          <div class="services">
            @for (s of offer()!.additionalServices; track s.id) {
              <div class="service">
                <div class="serviceTop">
                  <div class="serviceName">{{ s.name }}</div>
                  <div class="servicePrice">{{ s.pricePerDay }} EUR/day</div>
                </div>
                <div class="serviceDesc">{{ s.description }}</div>
              </div>
            }
          </div>
        }
      </div>

      <div class="card cardFull">
        <h3 class="sectionTitle">Pricing summary</h3>

        <div class="pricing">
          <div class="pricingRow">
            <span class="pricingLabel">Base / day</span>
            <span class="pricingValue">{{ offer()!.basePricePerDay }} EUR</span>
          </div>

          <div class="pricingRow">
            <span class="pricingLabel">Vehicle + insurance + base / day</span>
            <span class="pricingValue">{{ getTotalBasePerDay() }} EUR</span>
          </div>

          <div class="pricingRow">
            <span class="pricingLabel">Additional services total / day</span>
            <span class="pricingValue">{{ getAdditionalServicesTotalPerDay() }} EUR</span>
          </div>
        </div>
      </div>
    </div>
  }
</section>
